# RookiePlague 使用指南

本指南面向服务器管理者与插件使用者，介绍玩法、配置、命令与注意事项。

## 1. 安装与启动

1. 使用 Paper 1.21+。
2. 将插件 jar 放入服务器 `plugins` 目录。
3. 启动服务器，插件会自动生成默认配置。

## 2. 玩法说明

- 当某区块内同类动物数量超过上限时，插件会根据公式计算染疫概率。
- 被染疫的动物会受到周期性伤害，持续超过设定时间后会死亡。
- 若配置了尸体掉落与 MythicMobs，会在死亡位置生成对应怪物。
- 繁殖次数达到上限后，动物会被标记并阻止继续繁殖。

## 3. 配置文件

默认配置位于 `plugins/RookiePlague/`。

### 3.1 主配置 `config.yml`

常用项：

- `settings.language`: 语言文件名，默认 `zh_CN`
- `settings.debug`: 开启调试输出
- `plague.enabled`: 是否启用瘟疫系统
- `plague.formula`: 染疫概率公式（exp4j 语法）
- `plague.schedule.*`: 任务调度间隔/延迟
- `plague.damage.*`: 伤害参数

### 3.2 动物配置 `animal.yml`

支持列表格式，示例：

```yaml
- type: 'SHEEP'
  desc: '羊'
  speciesFactor: 0.9
  chunkLimit: 18
  corpseDropRate: 70
  corpseMobid: 'animal_corpse_large'
  maxBreedTimes: 5
  plagueDeathTime: 320
```

字段说明：

- `type`: 实体类型（Bukkit `EntityType` 名称）
- `desc`: 显示名称
- `speciesFactor`: 物种因子
- `chunkLimit`: 同类动物区块上限
- `corpseDropRate`: 尸体掉落概率（0-100）
- `corpseMobid`: MythicMobs 的怪物 ID（可为空）
- `maxBreedTimes`: 最大繁殖次数
- `plagueDeathTime`: 致死时间（秒）

## 4. 命令与权限

主命令：`/rp`

### 4.1 命令

- `/rp reload`：重载配置
- `/rp simulate <动物类型> [key=value...]`：模拟染疫公式
- `/rp breedcount <set|add|reset> [值]`：修改目标动物繁殖次数
- `/rp help`：查看帮助

### 4.2 权限

- `rookieplague.admin.reload`
- `rookieplague.admin.simulate`
- `rookieplague.admin.breedcount`

## 5. 显示与提示

- 染疫与繁殖上限会在动物名字前显示符号。
- 符号可在 `config.yml` 中通过 `symbol.plague` 与 `symbol.breed` 修改。

## 6. 注意事项

1. 插件启动，加载配置与语言文件。
2. 任务调度开始运行：
   - 环境缓存更新任务
   - 染疫检测任务
   - 染疫伤害任务
3. 按公式计算区块内动物是否染疫。
4. 主线程应用染疫状态并更新显示名称。

## 7. 常见问题

**Q: 为什么没有动物染疫？**  
A: 检查 `plague.enabled` 是否为 true，`chunkLimit` 是否过高，以及公式是否导致概率过低。

**Q: 公式变量有哪些？**  
A: `baseChance`, `speciesFactor`, `count`, `limit`, `weatherFactor`, `biomeFactor`, `players`。

**Q: 伤害任务不生效？**  
A: 检查 `plague.damage.enabled` 和 `plague.schedule.damage-interval`。
