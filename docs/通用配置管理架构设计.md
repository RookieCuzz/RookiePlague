# RookiePlague é€šç”¨é…ç½®ç®¡ç†æ¶æ„è®¾è®¡

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡çš„é€šç”¨é…ç½®ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒçµæ´»çš„é…ç½®åŠ è½½ã€ç¼“å­˜ç®¡ç†å’Œä¸šåŠ¡æ•°æ®è§£æã€‚è¯¥æ¶æ„ä¸“ä¸º **åŠ¨ç‰©ç˜Ÿç–«ç³»ç»Ÿ** è®¾è®¡ï¼ŒåŒæ—¶å…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œå¯ä»¥è½»æ¾é€‚é…å…¶ä»–ç±»å‹çš„é…ç½®éœ€æ±‚ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ä¸šåŠ¡æœåŠ¡å±‚ (Service)                  â”‚
â”‚  - AnimalConfigService: åŠ¨ç‰©é…ç½®ä¸šåŠ¡é€»è¾‘     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        é…ç½®ç®¡ç†å±‚ (Config)                   â”‚
â”‚  - ConfigurationManager: é…ç½®ç¼“å­˜ä¸ç®¡ç†      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        SPI æ¥å£å±‚ (config.spi)               â”‚
â”‚  - ConfigurationLoader: é…ç½®åŠ è½½æ¥å£         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        å®ç°å±‚ (config.impl)                  â”‚
â”‚  - FileConfigurationLoader: æ–‡ä»¶åŠ è½½å®ç°     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        æ•°æ®æ¨¡å‹å±‚ (Model)                    â”‚
â”‚  - AnimalConfig: åŠ¨ç‰©é…ç½®æ•°æ®æ¨¡å‹            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„ç‰¹ç‚¹

- **åˆ†å±‚æ¸…æ™°**ï¼šå„å±‚èŒè´£æ˜ç¡®ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **æ¥å£é©±åŠ¨**ï¼šåŸºäº SPI è®¾è®¡ï¼Œæ”¯æŒå¤šç§å®ç°æ–¹å¼
- **ç¼“å­˜æœºåˆ¶**ï¼šé¿å…é‡å¤ I/Oï¼Œæå‡æ€§èƒ½
- **ç±»å‹å®‰å…¨**ï¼šå¼ºç±»å‹æ•°æ®æ¨¡å‹ï¼Œé¿å…é…ç½®è§£æé”™è¯¯
- **çº¿ç¨‹å®‰å…¨**ï¼šä½¿ç”¨ ConcurrentHashMap ä¿è¯å¹¶å‘å®‰å…¨

## ğŸ“¦ åŒ…ç»“æ„

```
com.cuzz.rookiePlague
â”œâ”€â”€ RookiePlague.java                   // ä¸»ç±»ï¼Œæ’ä»¶å…¥å£
â”œâ”€â”€ config/                             // é…ç½®ç®¡ç†åŒ…
â”‚   â”œâ”€â”€ ConfigurationManager.java      // é…ç½®ç®¡ç†å™¨ï¼ˆç¼“å­˜+ç»Ÿä¸€è®¿é—®ï¼‰
â”‚   â”œâ”€â”€ spi/                           // SPI æ¥å£åŒ…
â”‚   â”‚   â””â”€â”€ ConfigurationLoader.java   // é…ç½®åŠ è½½å™¨æ¥å£
â”‚   â””â”€â”€ impl/                          // å®ç°åŒ…
â”‚       â””â”€â”€ FileConfigurationLoader.java // æ–‡ä»¶é…ç½®åŠ è½½å™¨å®ç°
â”œâ”€â”€ model/                             // ä¸šåŠ¡é¢†åŸŸæ¨¡å‹åŒ…
â”‚   â””â”€â”€ AnimalConfig.java             // åŠ¨ç‰©é…ç½®æ•°æ®æ¨¡å‹
â””â”€â”€ service/                           // ä¸šåŠ¡æœåŠ¡åŒ…
    â””â”€â”€ AnimalConfigService.java      // åŠ¨ç‰©é…ç½®æœåŠ¡
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. ConfigurationLoader (SPI æ¥å£)

**èŒè´£**ï¼šå®šä¹‰é…ç½®åŠ è½½çš„æ ‡å‡†è¡Œä¸º

**æ¥å£å®šä¹‰**ï¼š
```java
public interface ConfigurationLoader {
    YamlConfiguration loadConfig(String name);
    YamlConfiguration reloadConfig(String name);
    boolean exists(String name);
}
```

**ç‰¹ç‚¹**ï¼š
- âœ… æ”¯æŒå¤šç§å®ç°æ–¹å¼ï¼ˆæ–‡ä»¶ã€äº‘ç«¯ã€æ•°æ®åº“ç­‰ï¼‰
- âœ… éµå¾ª SPI è®¾è®¡æ¨¡å¼
- âœ… ä¾¿äºæ‰©å±•å’Œæµ‹è¯•

### 2. FileConfigurationLoader (å®ç°ç±»)

**èŒè´£**ï¼šä»æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŠ è½½ YAML é…ç½®

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… è‡ªåŠ¨ä»æ’ä»¶èµ„æºå¤åˆ¶é»˜è®¤é…ç½®
- âœ… æ”¯æŒåˆ—è¡¨æ ¼å¼çš„ YAML æ–‡ä»¶ï¼ˆå¦‚ animal.ymlï¼‰
- âœ… å¤„ç†é…ç½®æ–‡ä»¶ä¸å­˜åœ¨çš„æƒ…å†µ
- âœ… åŠ è½½é»˜è®¤é…ç½®ä½œä¸º fallback

**å…³é”®å®ç°**ï¼š
```java
// ä½¿ç”¨ SnakeYAML æ£€æµ‹æ•°æ®ç±»å‹
Object data = yaml.load(fis);
if (data instanceof List) {
    // åˆ—è¡¨æ ¼å¼åŒ…è£…å¤„ç†
    String rootKey = getRootKeyFromFileName(name); // "animal.yml" -> "animals"
    config.set(rootKey, data);
} else {
    // æ™®é€š Map æ ¼å¼æ­£å¸¸åŠ è½½
    config = YamlConfiguration.loadConfiguration(configFile);
}
```

### 3. ConfigurationManager (ç®¡ç†å™¨)

**èŒè´£**ï¼šæä¾›ç»Ÿä¸€çš„é…ç½®è®¿é—®æ¥å£å’Œç¼“å­˜ç®¡ç†

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… é…ç½®ç¼“å­˜ï¼ˆé¿å…é‡å¤åŠ è½½ï¼‰
- âœ… é…ç½®çƒ­é‡è½½
- âœ… ç»Ÿä¸€è®¿é—®å…¥å£
- âœ… çº¿ç¨‹å®‰å…¨ï¼ˆConcurrentHashMapï¼‰
- âœ… æ‰¹é‡é‡è½½æ”¯æŒ

**API ç¤ºä¾‹**ï¼š
```java
ConfigurationManager manager = new ConfigurationManager(loader);

// è·å–é…ç½®ï¼ˆè‡ªåŠ¨ç¼“å­˜ï¼‰
YamlConfiguration config = manager.getConfig("animal.yml");

// é‡è½½é…ç½®ï¼ˆæ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½ï¼‰
YamlConfiguration reloaded = manager.reloadConfig("animal.yml");

// é‡è½½æ‰€æœ‰é…ç½®
manager.reloadAll();

// æ¸…ç©ºç¼“å­˜
manager.clearCache();
```

### 4. AnimalConfig (æ•°æ®æ¨¡å‹)

**èŒè´£**ï¼šåŠ¨ç‰©é…ç½®çš„æ•°æ®æ¨¡å‹å’Œè§£æé€»è¾‘

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|------|--------|
| `type` | String | åŠ¨ç‰©ç±»å‹ï¼ˆå”¯ä¸€æ ‡è¯†ï¼Œå¦‚ SHEEPã€CHICKENï¼‰ | - |
| `desc` | String | åŠ¨ç‰©æè¿°ï¼ˆä¸­æ–‡åç§°ï¼‰ | - |
| `speciesFactor` | double | ç‰©ç§å› å­ï¼ˆå½±å“æŸ“ç–«æ¦‚ç‡ï¼‰ | 1.0 |
| `chunkLimit` | int | åŒºå—ä¸Šé™ï¼ˆå•åŒºå—å†…æ•°é‡ä¸Šé™ï¼‰ | 10 |
| `corpseDropRate` | int | å°¸ä½“æ‰è½æ¦‚ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰ | 50 |
| `corpseMobid` | String | å°¸ä½“æ¨¡å‹IDï¼ˆCEæ¨¡å‹ï¼‰ | - |
| `maxBreedTimes` | int | æœ€å¤§ç¹æ®–æ¬¡æ•° | 5 |
| `plagueDeathTime` | int | ç˜Ÿç–«è‡´æ­»æ—¶é—´ï¼ˆç§’ï¼‰ | 300 |

**è§£ææ–¹æ³•**ï¼š

1. **åˆ—è¡¨è§£æ**ï¼š
```java
List<AnimalConfig> animals = AnimalConfig.parseFromConfig(config);
```

2. **Map è§£æ**ï¼ˆæ¨èï¼Œé«˜æ•ˆï¼‰ï¼š
```java
Map<String, AnimalConfig> animalMap = AnimalConfig.parseToMap(config);
AnimalConfig sheep = animalMap.get("SHEEP"); // O(1) æŸ¥æ‰¾
```

**ç‰¹ç‚¹**ï¼š
- âœ… ç±»å‹å®‰å…¨è½¬æ¢ï¼ˆintã€doubleã€Stringï¼‰
- âœ… æ”¯æŒé»˜è®¤å€¼
- âœ… åŒæ¨¡å¼è§£æï¼ˆList/Mapï¼‰
- âœ… è‡ªåŠ¨å¤„ç† YAML åˆ—è¡¨æ ¼å¼
- âœ… å®¹é”™æœºåˆ¶ï¼ˆè§£æå¤±è´¥ä¸ä¸­æ–­ï¼‰

### 5. AnimalConfigService (ä¸šåŠ¡æœåŠ¡)

**èŒè´£**ï¼šç®¡ç†åŠ¨ç‰©é…ç½®çš„ä¸šåŠ¡é€»è¾‘

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

| åŠŸèƒ½ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| åŠ è½½é…ç½® | `loadConfig()` | ä»é…ç½®æ–‡ä»¶åŠ è½½åŠ¨ç‰©é…ç½® |
| é‡è½½é…ç½® | `reloadConfig()` | çƒ­é‡è½½é…ç½® |
| æŸ¥è¯¢é…ç½® | `getAnimalConfig(String type)` | æ ¹æ®ç±»å‹æŸ¥è¯¢é…ç½®ï¼ˆO(1)ï¼‰ |
| è·å–æ‰€æœ‰é…ç½® | `getAllAnimals()` | è·å–æ‰€æœ‰åŠ¨ç‰©é…ç½® |
| è·å–ç±»å‹åˆ—è¡¨ | `getAllAnimalTypes()` | è·å–æ‰€æœ‰åŠ¨ç‰©ç±»å‹ |
| å­˜åœ¨æ€§æ£€æŸ¥ | `exists(String type)` | æ£€æŸ¥é…ç½®æ˜¯å¦å­˜åœ¨ |
| è·å–æ•°é‡ | `getAnimalCount()` | è·å–é…ç½®æ•°é‡ |

**é«˜çº§æŸ¥è¯¢åŠŸèƒ½**ï¼š

```java
// æ ¹æ®ç‰©ç§å› å­èŒƒå›´æŸ¥è¯¢
List<AnimalConfig> highRisk = service.getAnimalsBySpeciesFactor(1.2, 2.0);

// æ ¹æ®åŒºå—ä¸Šé™æŸ¥è¯¢
List<AnimalConfig> limited = service.getAnimalsByChunkLimit(15, 20);

// æ ¹æ®å°¸ä½“æ¨¡å‹æŸ¥è¯¢
List<AnimalConfig> largeCorpse = service.getAnimalsByCorpseMobid("animal_corpse_large");
```

## ğŸ“„ é…ç½®æ–‡ä»¶

### animal.yml - åŠ¨ç‰©é…ç½®

```yaml
- type: 'SHEEP'
  desc: 'ç¾Š'
  speciesFactor: 0.9
  chunkLimit: 18
  corpseDropRate: 70
  corpseMobid: 'animal_corpse_large'
  maxBreedTimes: 5
  plagueDeathTime: 320

- type: 'CHICKEN'
  desc: 'é¸¡'
  speciesFactor: 1.3
  chunkLimit: 20
  corpseDropRate: 60
  corpseMobid: 'animal_corpse_small'
  maxBreedTimes: 8
  plagueDeathTime: 240
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âœ… ä½¿ç”¨ YAML åˆ—è¡¨æ ¼å¼ï¼ˆä»¥ `-` å¼€å¤´ï¼‰
- âœ… åŠ è½½åè‡ªåŠ¨è½¬æ¢ä¸º `Map<String, AnimalConfig>`
- âœ… ä»¥ `type` å­—æ®µä½œä¸º Map çš„ key
- âœ… æ”¯æŒåŠ¨æ€æ·»åŠ æ–°çš„åŠ¨ç‰©ç±»å‹

## ğŸ”„ æ•°æ®æµç¨‹

### é…ç½®åŠ è½½æµç¨‹

```mermaid
graph TB
    A[æ’ä»¶å¯åŠ¨] --> B[åˆ›å»º FileConfigurationLoader]
    B --> C[åˆ›å»º ConfigurationManager]
    C --> D[åˆ›å»º AnimalConfigService]
    D --> E[è°ƒç”¨ loadConfig]
    E --> F[ConfigurationManager.getConfig]
    F --> G[FileConfigurationLoader.loadConfig]
    G --> H{æ–‡ä»¶å­˜åœ¨?}
    H -->|å¦| I[ä»èµ„æºå¤åˆ¶é»˜è®¤é…ç½®]
    H -->|æ˜¯| J[è¯»å–é…ç½®æ–‡ä»¶]
    I --> J
    J --> K[æ£€æµ‹æ–‡ä»¶æ ¼å¼]
    K --> L{æ˜¯åˆ—è¡¨æ ¼å¼?}
    L -->|æ˜¯| M[åŒ…è£…ä¸º animals: [list]]
    L -->|å¦| N[ç›´æ¥åŠ è½½]
    M --> O[è¿”å› YamlConfiguration]
    N --> O
    O --> P[ç¼“å­˜é…ç½®]
    P --> Q[AnimalConfig.parseToMap]
    Q --> R[è½¬æ¢ä¸º Map]
    R --> S[ç¼“å­˜åˆ° Service]
    S --> T[åŠ è½½å®Œæˆ]
```

### é…ç½®æŸ¥è¯¢æµç¨‹

```mermaid
graph LR
    A[ä¸šåŠ¡ä»£ç ] --> B[AnimalConfigService.getAnimalConfig]
    B --> C{ç¼“å­˜ä¸­å­˜åœ¨?}
    C -->|æ˜¯| D[O1 ç›´æ¥è¿”å›]
    C -->|å¦| E[è¿”å› null]
```

### é…ç½®é‡è½½æµç¨‹

```mermaid
graph TB
    A[é‡è½½å‘½ä»¤] --> B[AnimalConfigService.reloadConfig]
    B --> C[ConfigurationManager.reloadConfig]
    C --> D[æ¸…é™¤ç¼“å­˜]
    D --> E[FileConfigurationLoader.reloadConfig]
    E --> F[é‡æ–°è¯»å–æ–‡ä»¶]
    F --> G[æ›´æ–° Manager ç¼“å­˜]
    G --> H[AnimalConfig.parseToMap]
    H --> I[æ›´æ–° Service ç¼“å­˜]
    I --> J[é‡è½½å®Œæˆ]
```

## ğŸ¯ è®¾è®¡ä¼˜åŠ¿

### 1. æ¸…æ™°çš„èŒè´£åˆ†ç¦»

| ç»„ä»¶ | èŒè´£ |
|------|------|
| ConfigurationLoader | åªè´Ÿè´£åŠ è½½åŸå§‹é…ç½® |
| ConfigurationManager | åªè´Ÿè´£ç¼“å­˜å’Œç®¡ç† |
| AnimalConfig | åªè´Ÿè´£æ•°æ®è§£æå’Œè½¬æ¢ |
| AnimalConfigService | åªè´Ÿè´£ä¸šåŠ¡é€»è¾‘ |

### 2. é«˜æ‰©å±•æ€§
- âœ… SPI æ¥å£è®¾è®¡ï¼Œå¯è½»æ¾æ·»åŠ æ–°çš„åŠ è½½æ–¹å¼
- âœ… é…ç½®è§£æé€»è¾‘åœ¨æ¨¡å‹å±‚ï¼Œç‹¬ç«‹äºåŠ è½½é€»è¾‘
- âœ… æœåŠ¡å±‚å¯ä»¥å¼•ç”¨å…¶ä»–æœåŠ¡ï¼Œæ”¯æŒå¤æ‚ä¸šåŠ¡
- âœ… æ–°å¢åŠ¨ç‰©ç±»å‹åªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶

### 3. é«˜æ€§èƒ½
- âœ… é…ç½®ç¼“å­˜æœºåˆ¶ï¼ˆConfigurationManagerï¼‰
- âœ… Map ç»“æ„æä¾› O(1) æŸ¥æ‰¾æ•ˆç‡
- âœ… é¿å…é‡å¤æ–‡ä»¶ I/O
- âœ… çº¿ç¨‹å®‰å…¨çš„å¹¶å‘è®¿é—®

### 4. æ˜“ç»´æŠ¤
- âœ… åŒ…ç»“æ„æ¸…æ™°
- âœ… å„ç»„ä»¶èŒè´£æ˜ç¡®
- âœ… ä»£ç å¤ç”¨æ€§é«˜
- âœ… å•å…ƒæµ‹è¯•å‹å¥½

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åœ¨ä¸»ç±»ä¸­åˆå§‹åŒ–

```java
public class RookiePlague extends JavaPlugin {
    private ConfigurationManager configManager;
    private AnimalConfigService animalConfigService;
    
    @Override
    public void onEnable() {
        // åˆå§‹åŒ–é…ç½®ç®¡ç†å™¨
        ConfigurationLoader loader = new FileConfigurationLoader(this);
        configManager = new ConfigurationManager(loader);
        
        // åˆå§‹åŒ–åŠ¨ç‰©é…ç½®æœåŠ¡
        animalConfigService = new AnimalConfigService(configManager);
        
        // åŠ è½½é…ç½®
        if (animalConfigService.loadConfig()) {
            getLogger().info("æˆåŠŸåŠ è½½ " + animalConfigService.getAnimalCount() + " ä¸ªåŠ¨ç‰©é…ç½®");
            
            // è¾“å‡ºé…ç½®ä¿¡æ¯
            animalConfigService.getAllAnimals().forEach(config -> {
                getLogger().info(String.format("- %s(%s): ç‰©ç§å› å­=%.2f, åŒºå—ä¸Šé™=%d",
                        config.getDesc(), config.getType(),
                        config.getSpeciesFactor(), config.getChunkLimit()));
            });
        } else {
            getLogger().warning("åŠ è½½åŠ¨ç‰©é…ç½®å¤±è´¥");
        }
    }
    
    public AnimalConfigService getAnimalConfigService() {
        return animalConfigService;
    }
}
```

### åœ¨ä¸šåŠ¡é€»è¾‘ä¸­ä½¿ç”¨

```java
// è·å–æœåŠ¡
AnimalConfigService service = plugin.getAnimalConfigService();

// æŸ¥è¯¢å•ä¸ªé…ç½®
AnimalConfig sheep = service.getAnimalConfig("SHEEP");
if (sheep != null) {
    double factor = sheep.getSpeciesFactor();
    int chunkLimit = sheep.getChunkLimit();
    int deathTime = sheep.getPlagueDeathTime();
    
    getLogger().info(String.format("%s çš„æŸ“ç–«æ¦‚ç‡ç³»æ•°ä¸º %.2f", sheep.getDesc(), factor));
}

// éå†æ‰€æœ‰é…ç½®
for (AnimalConfig config : service.getAllAnimals()) {
    getLogger().info(config.getDesc() + " - " + config.getType());
}

// æŸ¥è¯¢é«˜å±åŠ¨ç‰©ï¼ˆç‰©ç§å› å­ > 1.0ï¼‰
List<AnimalConfig> highRisk = service.getAnimalsBySpeciesFactor(1.0, 2.0);
highRisk.forEach(config -> {
    getLogger().warning("é«˜å±åŠ¨ç‰©: " + config.getDesc());
});

// é‡è½½é…ç½®
if (service.reloadConfig()) {
    getLogger().info("é…ç½®é‡è½½æˆåŠŸ");
}
```

### åœ¨ç›‘å¬å™¨ä¸­ä½¿ç”¨

```java
public class AnimalBreedListener implements Listener {
    private final AnimalConfigService configService;
    
    public AnimalBreedListener(AnimalConfigService configService) {
        this.configService = configService;
    }
    
    @EventHandler
    public void onAnimalBreed(EntityBreedEvent event) {
        if (!(event.getEntity() instanceof Animals animal)) {
            return;
        }
        
        String type = animal.getType().name();
        AnimalConfig config = configService.getAnimalConfig(type);
        
        if (config != null) {
            // æ£€æŸ¥ç¹æ®–æ¬¡æ•°é™åˆ¶
            int currentBreeds = getBreedCount(animal);
            if (currentBreeds >= config.getMaxBreedTimes()) {
                event.setCancelled(true);
                // é€šçŸ¥ç©å®¶
            }
        }
    }
}
```

## ğŸ“ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„é…ç½®åŠ è½½æ–¹å¼

**ç¤ºä¾‹ï¼šä»æ•°æ®åº“åŠ è½½é…ç½®**

```java
public class DatabaseConfigurationLoader implements ConfigurationLoader {
    private final DataSource dataSource;
    
    public DatabaseConfigurationLoader(DataSource dataSource) {
        this.dataSource = dataSource;
    }
    
    @Override
    public YamlConfiguration loadConfig(String name) {
        try (Connection conn = dataSource.getConnection()) {
            // ä»æ•°æ®åº“æŸ¥è¯¢é…ç½®
            String sql = "SELECT config_data FROM configs WHERE name = ?";
            PreparedStatement stmt = conn.prepareStatement(sql);
            stmt.setString(1, name);
            ResultSet rs = stmt.executeQuery();
            
            if (rs.next()) {
                String yamlData = rs.getString("config_data");
                return YamlConfiguration.loadConfiguration(
                    new StringReader(yamlData)
                );
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return new YamlConfiguration();
    }
    
    @Override
    public YamlConfiguration reloadConfig(String name) {
        return loadConfig(name);
    }
    
    @Override
    public boolean exists(String name) {
        // æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨
        return false;
    }
}
```

**ä½¿ç”¨æ–¹å¼**ï¼š
```java
ConfigurationLoader loader = new DatabaseConfigurationLoader(dataSource);
ConfigurationManager manager = new ConfigurationManager(loader);
```

### æ·»åŠ æ–°çš„ä¸šåŠ¡æ¨¡å‹

**ç¤ºä¾‹ï¼šæ·»åŠ è¯ç‰©é…ç½®**

1. **åˆ›å»ºæ•°æ®æ¨¡å‹**ï¼š
```java
package com.cuzz.rookiePlague.model;

public class MedicineConfig {
    private String id;
    private String name;
    private int cureRate;
    private int price;
    
    // Getter/Setter...
    
    public static Map<String, MedicineConfig> parseToMap(YamlConfiguration config) {
        // è§£æé€»è¾‘
    }
}
```

2. **åˆ›å»ºæœåŠ¡ç±»**ï¼š
```java
package com.cuzz.rookiePlague.service;

public class MedicineConfigService {
    private final ConfigurationManager configManager;
    private Map<String, MedicineConfig> medicineMap;
    
    public MedicineConfigService(ConfigurationManager configManager) {
        this.configManager = configManager;
    }
    
    public boolean loadConfig() {
        YamlConfiguration config = configManager.getConfig("medicine.yml");
        this.medicineMap = MedicineConfig.parseToMap(config);
        return true;
    }
    
    public MedicineConfig getMedicine(String id) {
        return medicineMap.get(id);
    }
}
```

3. **åœ¨ä¸»ç±»ä¸­æ³¨å†Œ**ï¼š
```java
private MedicineConfigService medicineService;

@Override
public void onEnable() {
    // ... åˆå§‹åŒ–é…ç½®ç®¡ç†å™¨
    
    medicineService = new MedicineConfigService(configManager);
    medicineService.loadConfig();
}
```

### æ·»åŠ é…ç½®éªŒè¯

```java
public class AnimalConfigService {
    
    public boolean loadConfig() {
        try {
            YamlConfiguration config = configManager.getConfig(CONFIG_FILE);
            this.animalConfigMap = AnimalConfig.parseToMap(config);
            
            // é…ç½®éªŒè¯
            validateConfigs();
            
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }
    
    private void validateConfigs() {
        for (AnimalConfig config : animalConfigMap.values()) {
            // éªŒè¯ç‰©ç§å› å­èŒƒå›´
            if (config.getSpeciesFactor() < 0.1 || config.getSpeciesFactor() > 2.0) {
                throw new IllegalArgumentException(
                    config.getType() + " çš„ç‰©ç§å› å­è¶…å‡ºèŒƒå›´ [0.1, 2.0]"
                );
            }
            
            // éªŒè¯åŒºå—ä¸Šé™
            if (config.getChunkLimit() <= 0) {
                throw new IllegalArgumentException(
                    config.getType() + " çš„åŒºå—ä¸Šé™å¿…é¡»å¤§äº 0"
                );
            }
            
            // éªŒè¯å°¸ä½“æ‰è½æ¦‚ç‡
            if (config.getCorpseDropRate() < 0 || config.getCorpseDropRate() > 100) {
                throw new IllegalArgumentException(
                    config.getType() + " çš„å°¸ä½“æ‰è½æ¦‚ç‡å¿…é¡»åœ¨ [0, 100] èŒƒå›´å†…"
                );
            }
        }
    }
}
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| é…ç½®åŠ è½½å¤±è´¥ | æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ ¼å¼é”™è¯¯ | æ£€æŸ¥ resources ç›®å½•å’Œ YAML è¯­æ³• |
| è§£æè¿”å›ç©ºåˆ—è¡¨ | æ ¹é”®åä¸åŒ¹é… | ç¡®è®¤ä½¿ç”¨ "animals" æˆ– "animal" |
| çƒ­é‡è½½ä¸ç”Ÿæ•ˆ | æœªè°ƒç”¨ reloadConfig | ç¡®ä¿æ­£ç¡®è°ƒç”¨æœåŠ¡çš„é‡è½½æ–¹æ³• |
| é…ç½®å€¼ä¸ºé»˜è®¤å€¼ | å­—æ®µåæ‹¼å†™é”™è¯¯ | æ£€æŸ¥ YAML å­—æ®µåä¸æ¨¡å‹å­—æ®µä¸€è‡´ |
| æ€§èƒ½ä¸‹é™ | é¢‘ç¹é‡è½½é…ç½® | ä½¿ç”¨ç¼“å­˜ï¼Œé¿å…ä¸å¿…è¦çš„é‡è½½ |

### è°ƒè¯•æŠ€å·§

```java
// å¼€å¯è°ƒè¯•æ—¥å¿—
public class AnimalConfigService {
    private static final boolean DEBUG = true;
    
    public AnimalConfig getAnimalConfig(String type) {
        AnimalConfig config = animalConfigMap.get(type);
        
        if (DEBUG) {
            if (config == null) {
                plugin.getLogger().warning("é…ç½®ä¸å­˜åœ¨: " + type);
                plugin.getLogger().warning("å¯ç”¨é…ç½®: " + animalConfigMap.keySet());
            } else {
                plugin.getLogger().info("æ‰¾åˆ°é…ç½®: " + config);
            }
        }
        
        return config;
    }
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ä¼˜åŒ–æªæ–½

| ä¼˜åŒ–é¡¹ | å®ç°æ–¹å¼ | æ•ˆæœ |
|--------|----------|------|
| é…ç½®ç¼“å­˜ | ConfigurationManager å†…å­˜ç¼“å­˜ | é¿å…é‡å¤ I/O |
| Map æŸ¥è¯¢ | ä½¿ç”¨ LinkedHashMap å­˜å‚¨ | O(1) æŸ¥æ‰¾æ•ˆç‡ |
| å»¶è¿ŸåŠ è½½ | é¦–æ¬¡è®¿é—®æ—¶æ‰åŠ è½½ | å‡å°‘å¯åŠ¨æ—¶é—´ |
| çº¿ç¨‹å®‰å…¨ | ConcurrentHashMap | æ”¯æŒå¹¶å‘è®¿é—® |
| æ‰¹é‡æ“ä½œ | reloadAll() æ–¹æ³• | å‡å°‘æ–¹æ³•è°ƒç”¨ |

### æ€§èƒ½æµ‹è¯•

```java
// æµ‹è¯•é…ç½®æŸ¥è¯¢æ€§èƒ½
long start = System.nanoTime();
for (int i = 0; i < 10000; i++) {
    service.getAnimalConfig("SHEEP");
}
long end = System.nanoTime();
getLogger().info("10000 æ¬¡æŸ¥è¯¢è€—æ—¶: " + (end - start) / 1000000.0 + "ms");
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. é…ç½®æ–‡ä»¶åˆ†ç¦»
```
resources/
â”œâ”€â”€ animal.yml      # åŠ¨ç‰©é…ç½®
â”œâ”€â”€ medicine.yml    # è¯ç‰©é…ç½®
â”œâ”€â”€ plague.yml      # ç˜Ÿç–«é…ç½®
â””â”€â”€ config.yml      # ä¸»é…ç½®
```

### 2. æœåŠ¡å±‚ä¼˜å…ˆ
```java
// âŒ ä¸æ¨èï¼šç›´æ¥è®¿é—®é…ç½®ç®¡ç†å™¨
YamlConfiguration config = configManager.getConfig("animal.yml");
Map<String, Object> data = config.getConfigurationSection("animals").getValues(false);

// âœ… æ¨èï¼šé€šè¿‡æœåŠ¡å±‚è®¿é—®
AnimalConfig sheep = animalConfigService.getAnimalConfig("SHEEP");
```

### 3. ç¼“å­˜ä¼˜å…ˆ
```java
// âŒ ä¸æ¨èï¼šæ¯æ¬¡éƒ½ä»æ–‡ä»¶è¯»å–
YamlConfiguration config = configManager.reloadConfig("animal.yml");

// âœ… æ¨èï¼šä½¿ç”¨ç¼“å­˜
YamlConfiguration config = configManager.getConfig("animal.yml");
```

### 4. ç±»å‹å®‰å…¨
```java
// âŒ ä¸æ¨èï¼šç›´æ¥æ“ä½œ YAML
double factor = config.getDouble("animals.SHEEP.speciesFactor");

// âœ… æ¨èï¼šä½¿ç”¨å¼ºç±»å‹æ¨¡å‹
AnimalConfig sheep = service.getAnimalConfig("SHEEP");
double factor = sheep.getSpeciesFactor();
```

### 5. é”™è¯¯å¤„ç†
```java
// âœ… æ¨èï¼šé€‚å½“å¤„ç†ç©ºå€¼
AnimalConfig config = service.getAnimalConfig(type);
if (config == null) {
    getLogger().warning("æœªæ‰¾åˆ°åŠ¨ç‰©é…ç½®: " + type);
    return;
}

// ä½¿ç”¨é…ç½®
int limit = config.getChunkLimit();
```

## ğŸ”„ ä¸åŸæ¶æ„çš„å·®å¼‚

### ä¸»è¦å˜æ›´

| é¡¹ç›® | åŸæ¶æ„ (MonsterController) | æ–°æ¶æ„ (RookiePlague) |
|------|---------------------------|----------------------|
| æ•°æ®æ¨¡å‹ | MonsterConfig | AnimalConfig |
| ä¸šåŠ¡æœåŠ¡ | MonsterService | AnimalConfigService |
| é…ç½®æ–‡ä»¶ | monsters.yml | animal.yml |
| æ ¸å¿ƒå­—æ®µ | id, type, rangeChunk, restrainRate, spawnRate, dropMulti, shinyMob | type, desc, speciesFactor, chunkLimit, corpseDropRate, corpseMobid, maxBreedTimes, plagueDeathTime |

### ä¿ç•™å†…å®¹

- âœ… SPI æ¥å£è®¾è®¡ (ConfigurationLoader)
- âœ… æ–‡ä»¶åŠ è½½å®ç° (FileConfigurationLoader)
- âœ… é…ç½®ç®¡ç†å™¨ (ConfigurationManager)
- âœ… åˆ—è¡¨æ ¼å¼ YAML æ”¯æŒ
- âœ… Map ç»“æ„ç¼“å­˜
- âœ… çƒ­é‡è½½æœºåˆ¶

### æ”¹è¿›å†…å®¹

- âœ… æ›´ä¸°å¯Œçš„åŠ¨ç‰©å±æ€§å­—æ®µ
- âœ… æ›´å¼ºçš„ç±»å‹å®‰å…¨ä¿è¯
- âœ… æ›´å®Œå–„çš„æŸ¥è¯¢API
- âœ… æ›´è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- âœ… æ›´å¥½çš„é”™è¯¯å¤„ç†

## ğŸ“š æ€»ç»“

æœ¬é€šç”¨é…ç½®ç®¡ç†æ¶æ„å…·å¤‡ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š

1. **é€šç”¨æ€§å¼º**ï¼šå¯å¿«é€Ÿé€‚é…ä¸åŒç±»å‹çš„é…ç½®éœ€æ±‚
2. **æ‰©å±•æ€§å¥½**ï¼šSPI è®¾è®¡æ”¯æŒå¤šç§åŠ è½½æ–¹å¼
3. **æ€§èƒ½ä¼˜å¼‚**ï¼šç¼“å­˜æœºåˆ¶ + O(1) æŸ¥è¯¢
4. **æ˜“äºç»´æŠ¤**ï¼šæ¸…æ™°çš„åˆ†å±‚æ¶æ„å’ŒèŒè´£åˆ’åˆ†
5. **ç±»å‹å®‰å…¨**ï¼šå¼ºç±»å‹æ¨¡å‹é¿å…é…ç½®é”™è¯¯
6. **çº¿ç¨‹å®‰å…¨**ï¼šæ”¯æŒå¹¶å‘è®¿é—®åœºæ™¯

é€šè¿‡æœ¬æ¶æ„ï¼Œæ‚¨å¯ä»¥è½»æ¾ç®¡ç† RookiePlague æ’ä»¶çš„åŠ¨ç‰©é…ç½®ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å¿«é€Ÿæ‰©å±•åˆ°å…¶ä»–é…ç½®åœºæ™¯ï¼Œå¦‚è¯ç‰©é…ç½®ã€ç˜Ÿç–«é…ç½®ç­‰ã€‚
